
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../structure/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.2">
    
    
      
        <title>Overview - APTrust Preservation Services</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#system-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="APTrust Preservation Services" class="md-header__button md-logo" aria-label="APTrust Preservation Services" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            APTrust Preservation Services
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/APTrust/preserv-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="APTrust Preservation Services" class="md-nav__button md-logo" aria-label="APTrust Preservation Services" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    APTrust Preservation Services
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/APTrust/preserv-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-high-level" class="md-nav__link">
    <span class="md-ellipsis">
      The High Level
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingest" class="md-nav__link">
    <span class="md-ellipsis">
      Ingest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ingest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nsq" class="md-nav__link">
    <span class="md-ellipsis">
      NSQ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rediselasticache" class="md-nav__link">
    <span class="md-ellipsis">
      Redis/Elasticache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-pre-fetch-worker" class="md-nav__link">
    <span class="md-ellipsis">
      The Pre-Fetch Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-validation-worker" class="md-nav__link">
    <span class="md-ellipsis">
      The Validation Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reingest-check" class="md-nav__link">
    <span class="md-ellipsis">
      Reingest Check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#staging-uploader" class="md-nav__link">
    <span class="md-ellipsis">
      Staging Uploader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-identifier" class="md-nav__link">
    <span class="md-ellipsis">
      Format Identifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preservation-uploader" class="md-nav__link">
    <span class="md-ellipsis">
      Preservation Uploader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preservation-verifier" class="md-nav__link">
    <span class="md-ellipsis">
      Preservation Verifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preservation Verifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-does-the-preservation-verifier-exist" class="md-nav__link">
    <span class="md-ellipsis">
      Why Does the Preservation Verifier Exist?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recorder" class="md-nav__link">
    <span class="md-ellipsis">
      Recorder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      Cleanup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restoration" class="md-nav__link">
    <span class="md-ellipsis">
      Restoration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Deletion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bulk-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Bulk Deletion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixity-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Fixity Checks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Structure
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/nsq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Registry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Workers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/anatomy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anatomy of a Worker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ingest
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Ingest
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingest Workers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/bucket-reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Bucket Reader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/pre-fetch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Metadata Gatherer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/validator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Bag Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/reingest-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Reingest Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/staging-uploader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Staging Uploader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/format-identifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Format Identifier
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/preservation-uploader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Preservation Uploader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/preservation-verifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Preservation Verifier
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/recorder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Recorder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/ingest/cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cleanup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/fixity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fixity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/restoration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Restoration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workers/deletion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deletion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../auditor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auditor
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-high-level" class="md-nav__link">
    <span class="md-ellipsis">
      The High Level
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingest" class="md-nav__link">
    <span class="md-ellipsis">
      Ingest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ingest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nsq" class="md-nav__link">
    <span class="md-ellipsis">
      NSQ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rediselasticache" class="md-nav__link">
    <span class="md-ellipsis">
      Redis/Elasticache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-pre-fetch-worker" class="md-nav__link">
    <span class="md-ellipsis">
      The Pre-Fetch Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-validation-worker" class="md-nav__link">
    <span class="md-ellipsis">
      The Validation Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reingest-check" class="md-nav__link">
    <span class="md-ellipsis">
      Reingest Check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#staging-uploader" class="md-nav__link">
    <span class="md-ellipsis">
      Staging Uploader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-identifier" class="md-nav__link">
    <span class="md-ellipsis">
      Format Identifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preservation-uploader" class="md-nav__link">
    <span class="md-ellipsis">
      Preservation Uploader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preservation-verifier" class="md-nav__link">
    <span class="md-ellipsis">
      Preservation Verifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preservation Verifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-does-the-preservation-verifier-exist" class="md-nav__link">
    <span class="md-ellipsis">
      Why Does the Preservation Verifier Exist?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recorder" class="md-nav__link">
    <span class="md-ellipsis">
      Recorder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      Cleanup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restoration" class="md-nav__link">
    <span class="md-ellipsis">
      Restoration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Deletion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bulk-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Bulk Deletion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixity-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Fixity Checks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="system-overview">System Overview</h1>
<p>Preservation services consists of the following components:</p>
<ul>
<li>A set of Docker containers, each running a microservice to handle various aspects of the ingest, restoration, deletion and fixity processes.</li>
<li>NSQ - a queue service for orchestrating work items.</li>
<li>Redis/Elasticache - for sharing interim processing data between workers.</li>
<li>S3, Glacier and Wasabi for storage</li>
<li>The Registry REST API for storing and retrieving persistent metadata about the content of our preservation repository.</li>
</ul>
<p>While other parts of this documentation describe the components in detail, this page provides a graphical overview of the system's components, where they live, and how they communicate.</p>
<h2 id="the-high-level">The High Level</h2>
<p>The components of the system are divided into three privilege zones, with privileges enforced by IAM roles and policies.</p>
<p>Depositors have access to the leftmost zone in the diagram below. They can upload files into their own receiving buckets for ingest, and download them from their own restoration buckets for retrieval. Depositors can access only their own buckets, no one else's.</p>
<p><img alt="" src="../img/architecture/Preserv-Zones-01.drawio.png" /></p>
<p>The rightmost zone is preservation storage. No one can access this except the IAM account of the Go workers, which has full access, and APTrust admins, who have read-only access.</p>
<p><img alt="" src="../img/architecture/Preserv-Zones-03.drawio.png" /></p>
<p>The Go service workers move items from depositor receiving buckets on the left into long-term preservation storage buckets on the right. They also move items from long-term storage back to depositor restoration buckets. The workers keep temporary housekeeping data about items in process in Redis/Elasticache, and store permanent data in the Registry. All of the working components of the system--all services using CPU and memory--live in the middle zone.</p>
<p><img alt="" src="../img/architecture/Preserv-Zones-02.drawio.png" /></p>
<p>Depositors cannot access anything in the middle zone. APTrust administrators can, generally through the AWS console and CloudFormation templates.</p>
<p>The diagram below shows all of the components in their respective zones. Details follow below.</p>
<p><img alt="High level diagram showing zones and components" src="../img/architecture/Preserv.drawio.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These diagrams omit three containers that run cron jobs. The bucket
reader, <code>ingest_bucket_reader</code>, scans depositor receiving buckets
for new ingests. It creates an ingest WorkItem for each new bag and
queues it in the NSQ <code>ingest01_prefetch</code> topic.</p>
<p>The <code>apt_queue_fixity</code> worker runs every half hour or so, queueing
files for fixity checks. Files stored in S3 and Wasabi are checked
every 90 days.</p>
<p>The <code>apt_queue</code> cron job queues deletion and restoration requests
created by Registry users. Those requests should be queued automatically
by Registry itself. If they're not, <code>apt_queue</code> will find them. This
cron job is a vestige from the old, unreliable Pharos system, which did
occasionally fail at queueing requests. It may no longer be needed,
but we'll keep it around as a failsafe.</p>
</div>
<h2 id="ingest">Ingest</h2>
<p>During the ingest process, depositors upload bags (tar files) to their receiving buckets. A cron scans for new bags, creating a WorkItem in the Registry for each one, and then putting that WorkItem's ID into NSQ for the Ingest workers to pick up.</p>
<p>Ingest workers perform a number of functions, including bag validation, format identification, and more. Then they move files into preservation storage and record the results of their work in the Registry.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-01.drawio.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the diagrams below, all ingest workers read to and write from
both Redis and NSQ. Arrows are omitted to minimize clutter.</p>
</div>
<h3 id="nsq">NSQ</h3>
<p>NSQ keeps track of which tasks need to go to which workers. For Ingest, a cron job running in the <code>ingest_bucket_reader</code> container creates and queues new WorkItems for each new bag that shows up in a receiving bucket.</p>
<p>For deletion and restoration, users make requests through the Registry Web UI, and Registry pushes the WorkItem IDs into NSQ's deletion and restoration topics.</p>
<p>For fixity checks, a cron job running in <code>apt_queue_fixity</code> queries Registry for files in S3 or Wasabi storage that have not had a fixity check in 90 days. It pushes the IDs of those files into NSQ, usually in batches of 2,500-3,000 every half hour.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-01-NSQ.drawio.png" /></p>
<h3 id="rediselasticache">Redis/Elasticache</h3>
<p>Redis stores info about what work has already been done on any task in the ingest process. New workers can pick up partially completed tasks and pick up work where the last worker left off. The housekeeping data in Redis ensures two things:</p>
<ol>
<li>that no work is skipped or left incomplete</li>
<li>that completed work is not unnecessarily repeated</li>
</ol>
<p><img alt="" src="../img/architecture/Preserv-Ingest-01-Redis.drawio.png" /></p>
<h3 id="the-pre-fetch-worker">The Pre-Fetch Worker</h3>
<p>The pre-fetch worker streams a bag from a depositor's receiving bucket through a series of functions to do the following:</p>
<ol>
<li>Gather a list of files in the bag.</li>
<li>Calculated fixity values on those files.</li>
<li>Extract tag files, manifests, and tag manifests to an S3 staging bucket for later processing.</li>
</ol>
<p><img alt="" src="../img/architecture/Preserv-Ingest-02-Pre-Fetch.drawio.png" /></p>
<h3 id="the-validation-worker">The Validation Worker</h3>
<p>The validation worker ensures a bag is valid according to its BagIt profile. APTrust currently supports APTrust and BTR (Beyond the Repository) BagIt formats.</p>
<p>A bag is valid if it contains all of the payload files mentioned in the manifests, and if the checksums of those files match the checksums in the manifests. The bag must also contain a set of BagIt standard tags with valid values, plus whatever tags are required by the specified BagIt profile.</p>
<p>Note that profiles also specify which checksum algorithms and required and which others are permitted. The validator enforces those rules as well. If a bag is incomplete, if it contains extraneous payload files not mentioned in the manifests, or if it is missing required tags or required checksum algoriths, it will fail validation, the system will not ingest it, and processing stops here.</p>
<p>The validation worker tends to complete its work quickly, generally in a fraction of a second. It simply analyzes all of the metadata stored in Redis by the pre-fetch worker, which as already done the hard work of inventorying contents and calculating checksums.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-03-Validate.drawio.png" /></p>
<h3 id="reingest-check">Reingest Check</h3>
<p>The reingest checker asks Registry if this bag has ever been ingested before. Bags have unique identifiers composed of the identifier of the owning instituion, followed by a slash and the name of the bag, minus the .tar extension. For example, if the University of Virginia uploads a bag called <code>photos.tar</code>, the bag's Intellectual Object Identifier becomes <code>virginia.edu/photos</code>.</p>
<p>If the Registry has an active (non-deleted) record of an object whose identifier matches the one we're currently ingesting, it checks each file in the new bag against records in the registry. If the file exists in Registry, the worker compares the Registry checksum to the checksum calculated by the pre-fetch worker.</p>
<p>If the checksum has changed, or if the file does not exist in Registry, the worker flags the file as needing to be saved to preservation storage. If Registry already has a record of this file and the checksum has not changed, the file will be flagged as not needing to be copied to preservation.</p>
<p>The reingest checker prevents us from storing duplicate copies of existing files under new UUIDs. (Everything in preservation storage is stored with a UUID key, not its original file name.)</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-03-ReingestCheck.drawio.png" /></p>
<h3 id="staging-uploader">Staging Uploader</h3>
<p>The staging uploader unpacks bags from depositor ingest buckets and stores their individual files in an S3 staging bucket. Files in the staging bucket are stored with a key composed of WorkItem ID and file UUID. E.g. <code>34546/ddeff40b-f995-42f0-b002-389cf331193d</code>.</p>
<p>Subsequent workers that need to access these files can retrieve them from this staging bucket. S3 works well for write-once/read-multiple workloads. Because it's a network resource, not tied to local block storage, its contents are available to all of our ingest workers.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-04-Staging.drawio.png" /></p>
<h3 id="format-identifier">Format Identifier</h3>
<p>The format identifier streams files from the staging bucket through a set of algorithms that compare the file's bits to known signatures in the PRONOM registry. It updates each file record in Redis with the file's mime type.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-06-FormatID.drawio.png" /></p>
<h3 id="preservation-uploader">Preservation Uploader</h3>
<p>The preservation upload copies files from the staging bucket to preservation storage.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-07-Storage.drawio.png" /></p>
<h3 id="preservation-verifier">Preservation Verifier</h3>
<p>The preservation verifier performs a HEAD request on every item copied into preservation storage to retrieve its metadata. Where possible, it compares each file's etag in preservation storage to its md5 checksum to ensure integrity. Etag comparison isn't possible on larger files, so it compares the file size in preservation with its know file size.</p>
<p>The verifier is basically a sanity check to provide basic assurance that files were successfully copied to preservation.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-08-StorageValidation.drawio.png" /></p>
<h4 id="why-does-the-preservation-verifier-exist">Why Does the Preservation Verifier Exist?</h4>
<p>We added this step to our older ingest system in 2017 after a bug in the AWS S3 client caused a number of files to be written to S3 with zero bytes. The zero-byte bug persisted for years. (APTrust has some internal documentation on this issue.)</p>
<p>To work around it, our old preservation uploader started asking S3, immediately after upload, how many bytes it had just sent. Oddly enough, whenever S3 received zero bytes, it would reply that it had received 8 TB. (AWS refutes this, but we have literally tens of thousands of log entries refuting their refutation.) The old preservation uploader would rewrite the file to S3 whenever S3 returned a different number of bytes than what we knew we had written.</p>
<p>The current ingest system uses the Minio S3 client, which has never shown the zero-byte bug, but we wanted to keep this sanity check in place after experiencing the cost of <em>not</em> having it.</p>
<h3 id="recorder">Recorder</h3>
<p>The recorder records metadata about the ingest in the Registry, including info about the Intellectual Object and all of its files. For each file, it records checksums, storage records and a set of ingest Premis events. It also records Premis events for the object.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-09-RecordMetadata.drawio.png" /></p>
<h3 id="cleanup">Cleanup</h3>
<p>The cleanup worker deletes the original bag from the depositor's receiving bucket, then deletes all interim processing data from the S3 staging bucket and Redis. Finally, it marks the ingest as complete in the Registry and in NSQ.</p>
<p><img alt="" src="../img/architecture/Preserv-Ingest-10-Cleanup.drawio.png" /></p>
<h2 id="restoration">Restoration</h2>
<p>APTrust users initiate object and file restoration through the Registry Web UI. They click a button to restore either an individual file, or an entire intellectual object (a bag).</p>
<p><img alt="" src="../img/architecture/Preserv-Restoration-01.drawio.png" /></p>
<p>Clicking the button causes Registry to create a restoration WorkItem, and to add the WorkItem ID to one of three NSQ topics:</p>
<ul>
<li>restore_object is the topic for object restoration.</li>
<li>restore_file is for file restoration.</li>
<li>restore_glacier is for Glacier restoration.</li>
</ul>
<p>Glacier restoration requires an extra step of moving files from an inaccessible Glacier vault into an accessible S3 bucket so the files can be restored. Once the Glacier restorer gets the necessary files into an accessible S3 bucket, it pushes the restoration request into the normal <code>restore_object</code> or <code>restore_file</code> topics.</p>
<p>File restorations involve copying only a single file into a depositor's restoration bucket. Object restorations require gathering and re-bagging sets of files and moving the whole tarred bag into the restoration bucket.</p>
<p><img alt="" src="../img/architecture/Preserv-Restoration-02.drawio.png" /></p>
<p>While the file restorer ensures a file's checksums are correct before making a restoration copy, the object restorer reassembles and validates an entire bag full of files. It does this on the fly, streaming files into a bag in the restoration bucket without those files ever touching local disk. It calculates checksums as it goes, ensuring the bag is valid and complete. If the bag is not valid or is incomplete, the restoration WorkItem will be marked as failed in the Registry.</p>
<p><img alt="" src="../img/architecture/Preserv-Restoration-03.drawio.png" /></p>
<p>Note that because we rebuild bags when we restore them, the restored bag will not exactly match the original bag. The payload should be the same (unless the depositor deleted some files before the restoration), but the order of files within the tar archive may differ.</p>
<p>In addition, we store the bag-info.txt, aptrust-info.txt and any other files outside the bag's payload directory, except bagit.txt and fetch.txt. We give these back to the depositor upon restoration. Depositors have been storing essential metadata in bag-info.txt, aptrust-info.txt and other non-payload files, and they want that info back when they do a restoration.</p>
<h2 id="deletion">Deletion</h2>
<p>Deletions are also initiated in the Registry. Once a deletion request has been created and approved by an institutional admin, Registry creates a deletion WorkItem and queues it in NSQ's <code>delete_item</code> topic.</p>
<p><img alt="" src="../img/architecture/Preserv-Deletion-01.drawio.png" /></p>
<p>For file deletions, the deletion worker deletes all copies of the specified file from all known locations. That's typically either one S3 bucket, one Glacier vault, or one Wasabi bucket. Items in Standard storage are deleted from both S3 in Virginia and Glacier in Oregon.</p>
<p>For object deletions, the deletion worker deletes all copies of all files that belong to the specified object.</p>
<p>After deletion, the worker records deletion Premis events for all of the deleted files, changes the state of those files from <code>A</code> (active) to <code>D</code> (deleted) in the Registry, and marks the WorkItem as done. For object deletions, the worker changes the object state to <code>D</code> and records a deletion Premis event for the object.</p>
<h2 id="bulk-deletion">Bulk Deletion</h2>
<p>Bulk deletion is a new feature, as of early 2024. We do not expose this feature to depositors because of its potential danger. If you would like to initial a bulk deletion, please contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#104;&#101;&#108;&#112;&#64;&#97;&#112;&#116;&#114;&#117;&#115;&#116;&#46;&#111;&#114;&#103;">&#104;&#101;&#108;&#112;&#64;&#97;&#112;&#116;&#114;&#117;&#115;&#116;&#46;&#111;&#114;&#103;</a>.</p>
<p>The basic process goes like this:</p>
<ol>
<li>You send APTrust a list of object identifiers. These identify objects you want to delete.</li>
<li>APTrust create a set of deletion requests on your behalf.</li>
<li>Registry sends a deletion approval email to administrators at your institution showing what is to be deleted and requesting they approve or deny the request.</li>
<li>Once an administrator approves the deletion, preservation services begins deleting the objects.</li>
</ol>
<p>We typically delete objects in batches of 500-1000 at a time. Therefore, a request to delete 2000 objects would likely result in two bulk deletions with two separate emails requiring approval.</p>
<h2 id="fixity-checks">Fixity Checks</h2>
<p>A containerized cron job called <code>apt_queue_fixity</code> runs every half hour or so, asking the Registry for a list of files stored in S3 or Wasabi that have not had a fixity check in the past 90 days. We do not check fixity on items in Glacier or Glacier Deep storage.</p>
<p><code>apt_queue_fixity</code> pushes the Generic File IDs of files needing a fixity check into the <code>fixity_check</code> queue, usually in batches of 2,500 or 3,000.</p>
<p><img alt="" src="../img/architecture/Preserv-Fixity.drawio.png" /></p>
<p>The fixity checker calculates checksums on the bitstream coming from S3 or Wasabi. The files never touch local disk. It records the results of each fixity check in a Premis event.</p>
<p>The fixity checker is the only worker whose tasks are not recorded in WorkItems. It would be excessive to do so, since the system has performed over a hundred million checks, and all the data we need to capture from a check is captured in the Premis event.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f13b1293.min.js"></script>
      
    
  </body>
</html>